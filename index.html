<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="format-detection" content="telephone=no" />
  <title>IngressAI — Ingressos em minutos, direto no WhatsApp</title>
  <meta name="description" content="Compre ingressos em minutos pelo WhatsApp. Vitrine por cidade, checkout instantâneo, repasse instantâneo (T+0) e validação por QR Code." />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <link rel="canonical" href="https://ingressai.chat/" />
  <meta property="og:title" content="IngressAI — Ingressos em minutos" />
  <meta property="og:description" content="Vitrine por cidade, checkout instantâneo, QR Code antifraude e repasse instantâneo (T+0)." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://ingressai.chat/" />
  <meta property="og:image" content="https://ingressai.chat/logo_ingressai.png" />
  <meta property="og:site_name" content="IngressAI" />
  <meta property="og:locale" content="pt_BR" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="theme-color" content="#2F7DD9" />
  <meta name="color-scheme" content="light" />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
  <link rel="icon" href="/favicon.png" type="image/png" sizes="32x32" />
  <link rel="preload" as="image" href="/logo_ingressai.png" />
  <!-- Perf -->
  <link rel="preconnect" href="https://ingressai-backend-production.up.railway.app" crossorigin>
  <link rel="dns-prefetch" href="//ingressai-backend-production.up.railway.app">
  <link rel="dns-prefetch" href="//wa.me">

  <style>
    /* ====== Design system (apple-like + razão áurea) ====== */
    :root{
      --phi:1.618;
      --s0:8px; --s1:calc(var(--s0)*var(--phi));
      --s2:calc(var(--s1)*var(--phi));
      --s3:calc(var(--s2)*var(--phi));
      --s4:calc(var(--s3)*var(--phi));
      --fs-0:16px; --fs--1:calc(var(--fs-0)/var(--phi));
      --fs-1:calc(var(--fs-0)*var(--phi));
      --fs-2:calc(var(--fs-1)*var(--phi));
      --lh-compact:1.22; --lh:1.45;
      --ink:#0b1220; --muted:#5b6b86; --bg:#f6f8fc; --card:#ffffff;
      --blue-1:#4A93F0; --blue-2:#2F7DD9; --blue-3:#1B5FB3; --blue-soft:#eaf3ff;
      --red-soft:#c94747;
      --shadow:0 10px 28px rgba(47,125,217,.14),0 2px 6px rgba(11,18,32,.08);
      --shadow-soft:0 6px 18px rgba(47,125,217,.12);
      --ring:0 0 0 2px rgba(74,147,240,.18);
      --container-max:calc(680px*var(--phi));
      --ico:clamp(40px,7vw,64px); --btn-h:52px; --radius-pill:999px;
      --t-fast:.18s; --t-med:.28s
    }
    @media (max-width: 380px){
      :root{ --btn-h:46px; }
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
      font:16px/var(--lh) -apple-system,BlinkMacSystemFont,"SF Pro Text","SF Pro Display",Segoe UI,Roboto,Ubuntu,Inter,system-ui,sans-serif}
    a{color:inherit;text-decoration:none}
    :focus-visible{outline:none;box-shadow:var(--ring)}
    @media (prefers-reduced-motion: reduce){*{scroll-behavior:auto!important;transition:none!important;animation:none!important}}

    .container{max-width:var(--container-max);margin:0 auto;padding:0 var(--s2)}
    @media(min-width:720px){ .container{padding:0 var(--s3)} }
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);clip-path:inset(50%);white-space:nowrap;border:0}
    .subtle{color:var(--muted)}
    :where(section,[id]){scroll-margin-top:96px}

    /* ===== Header ===== */
    header{position:sticky;top:0;z-index:20;background:#fff;
      border-bottom:1px solid #e7eefb;transition:box-shadow var(--t-fast),border-color var(--t-fast),background-color var(--t-fast)}
    header.is-scrolled{box-shadow:var(--shadow);border-color:#e1e9fb}
    .nav{display:flex;flex-direction:column;align-items:center;gap:var(--s1);padding:var(--s1) 0}

    /* ===== Hero ===== */
    .hero{padding:var(--s4) 0;opacity:calc(1 - var(--hero-p,0));transform:translateY(calc(-6px * var(--hero-p,0)));
      transition:opacity var(--t-fast) linear,transform var(--t-fast) linear}
    .hero.is-hidden{opacity:0;height:0;padding:0;margin:0;overflow:hidden}
    .hero h1{font-size:clamp(calc(1.25rem*var(--phi)),6.2vw,calc(1.25rem*var(--phi)*var(--phi)));
      line-height:var(--lh-compact);margin:0 0 var(--s2) 0;font-weight:850;text-align:center;letter-spacing:-.015em}
    .hero-brand{display:grid;gap:var(--s1);place-items:center;margin-bottom:var(--s2)}
    .badges{display:flex;gap:calc(var(--s1)*1.2);align-items:center;justify-content:center;flex-wrap:wrap;margin-top:6px}
    .badge{display:inline-flex;align-items:center;gap:.55rem;font-weight:700;user-select:none}
    .badge img{height:18px;width:auto;display:block}
    .badge span{color:#445570;font-weight:700;opacity:.95}

    /* ===== Buttons ===== */
    .btn{min-height:var(--btn-h);padding:0 var(--s2);border-radius:var(--radius-pill);
      border:1px solid #d6e4ff;display:inline-flex;align-items:center;justify-content:center;
      font-weight:800;letter-spacing:.2px;gap:10px;background:#fff;color:#0b1220;
      transition:transform .08s,box-shadow var(--t-fast); touch-action:manipulation}
    .btn--secondary{box-shadow:var(--shadow-soft)}
    .btn--ghost{background:#fff;border-color:#e1e8f6;box-shadow:none;color:#2d3b50}
    .btn--sm{min-height:40px;padding:0 .9rem;font-size:.92rem}
    .btn:active{transform:translateY(1px) scale(.98)}
    .btn.is-disabled, button:disabled{opacity:.6;pointer-events:none;filter:grayscale(.08)}
    @keyframes btn-press{0%{transform:translateY(0) scale(1)}50%{transform:translateY(1px) scale(.98)}100%{transform:translateY(0) scale(1)}}
    .btn-press{animation:btn-press var(--t-fast) ease}

    .cta-inline{display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-start;margin:calc(var(--s1)*-1) 0 var(--s1)}

    /* ===== Features ===== */
    .proofs{padding:var(--s2) 0 var(--s3)}
    .features{display:grid;gap:var(--s0);grid-template-columns:repeat(2,minmax(0,1fr))}
    @media(min-width:900px){.features{grid-template-columns:repeat(4,minmax(0,1fr))}}
    .feature{background:var(--card);border:1px solid #e5ecff;border-radius:12px;padding:calc(var(--s0)*1.25);
      display:flex;flex-direction:column;align-items:center;gap:var(--s0);box-shadow:none}
    .feature svg{color:#000;stroke:currentColor;stroke-width:1.1;fill:none;stroke-linecap:round;stroke-linejoin:round;
      width:clamp(28px,8vw,36px);height:clamp(28px,8vw,36px)}
    .feature .bolt{fill:currentColor;stroke:none}
    .feature .cut{fill:var(--card);stroke:none}
    .feature .qr-fill{fill:currentColor;stroke:none}
    .feature .meta{display:flex;flex-direction:column;gap:calc(var(--s0)/var(--phi));align-items:center}
    .feature strong{font-weight:800;font-size:calc(var(--fs-0)*1.02);line-height:1.2;text-align:center}
    .feature small{color:var(--muted);font-size:calc(var(--fs--1));line-height:1.4;text-align:center}

    /* ===== Sections ===== */
    .section{padding:calc(var(--s4)*1.1) 0;content-visibility:auto}
    .section h2{font-size:clamp(calc(1rem*var(--phi)),3.8vw,calc(1.1rem*var(--phi)*var(--phi)));margin:0 0 var(--s2) 0;font-weight:800;letter-spacing:-.01em}

    /* ===== Vitrine ===== */
    .filters{display:grid;grid-template-columns:1fr;gap:var(--s1);margin:0 0 var(--s1) 0}
    @media(min-width:680px){.filters{grid-template-columns:1fr max-content}}
    .search input{width:100%;border:1px solid #e5ecff;border-radius:999px;padding:.8rem 1rem;font:inherit;box-shadow:var(--shadow-soft);font-weight:600}
    .chips{display:flex;gap:8px;align-items:center;overflow:auto;padding-bottom:2px}
    .chip{appearance:none;border:1px solid #e5ecff;background:#fff;border-radius:999px;padding:.5rem .85rem;font-weight:800;color:#415577;cursor:pointer;white-space:nowrap}
    .chip[aria-checked="true"]{background:var(--blue-2);color:#fff;border-color:rgba(27,95,179,.35);box-shadow:0 6px 14px rgba(47,125,217,.25)}

    .cards{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:var(--s1);overflow-anchor:none}
    @media(min-width:700px){.cards{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:1000px){.cards{grid-template-columns:repeat(3,minmax(0,1fr))}}
    #lista-eventos.cards{grid-template-columns:repeat(2,minmax(0,1fr))}
    .card{background:var(--card);border-radius:calc(var(--s2));box-shadow:var(--shadow);padding:var(--s2);border:1px solid #eaf1ff;
      display:flex;flex-direction:column;gap:var(--s1);transition:transform .12s,box-shadow var(--t-fast);position:relative;content-visibility:auto;contain-intrinsic-size:300px;overflow:hidden}
    .card:hover{transform:translateY(-2px);box-shadow:0 14px 36px rgba(47,125,217,.16),0 3px 8px rgba(11,18,32,.12)}
    .card[role="button"]{cursor:pointer}
    .card-header{display:flex;align-items:flex-start;justify-content:space-between;gap:var(--s1);padding-right:0}
    .card-title{font-weight:900;font-size:clamp(1rem,2.2vw,1.14rem);line-height:1.18;margin-bottom:4px;letter-spacing:-.01em}
    .card-city{color:#2F7DD9;font-weight:800;font-size:.94rem}
    .status-line{display:flex;align-items:center;gap:8px;margin-top:4px;font-weight:800;font-size:.86rem}
    .status-dot{width:.6rem;height:.6rem;border-radius:999px;display:inline-block;flex:0 0 .6rem;border:1px solid rgba(0,0,0,.06)}
    .status--soon .status-dot{background:#cfe3ff}
    .status--low .status-dot{background:#ffdede}
    .status--sold .status-dot{background:#dcdde3}
    .status--soon{color:#1B5FB3}
    .status--low{color:#b64848}
    .status--sold{color:#6b7280}
    .card-media{width:100%;aspect-ratio:1.35;border-radius:calc(var(--s1));border:1px solid #eaf1ff;background:radial-gradient(600px 280px at 20% 0%,rgba(47,125,217,.12),transparent 60%),linear-gradient(180deg,#fff,#f5f9ff);display:grid;place-items:center;color:#8fb5ff;font-weight:800}
    .card-media img{width:100%;height:100%;object-fit:cover;border-radius:inherit;display:block}

    .view{background:#fff;border:1px solid #e5ecff;color:#2d3b50;font-weight:800;cursor:pointer;padding:.3rem .7rem;border-radius:999px;align-self:center;min-height:28px;font-size:.82rem;margin-top:auto;box-shadow:0 6px 16px rgba(47,125,217,.16),0 2px 6px rgba(11,18,32,.08);transition:transform .12s ease,box-shadow var(--t-fast),filter var(--t-fast)}
    .view:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(47,125,217,.2),0 4px 10px rgba(11,18,32,.12)}

    /* ===== Bottom Sheet ===== */
    .sheet-backdrop{position:fixed;inset:0;background:rgba(11,18,32,.36);opacity:0;pointer-events:none;transition:opacity var(--t-fast)}
    .sheet-backdrop.is-open{opacity:1;pointer-events:auto}
    .sheet{position:fixed;left:0;right:0;bottom:0;height:72vh;max-height:760px;background:#fff;border-top-left-radius:24px;border-top-right-radius:24px;box-shadow:0 -24px 48px rgba(11,18,32,.16);transform:translateY(100%);transition:transform var(--t-med) cubic-bezier(.2,.7,.2,1);display:flex;flex-direction:column;padding:var(--s2);z-index:40;--close-hit:64px}
    .sheet.is-open{transform:translateY(0)}
    .sheet h3{margin:0;font-weight:900;line-height:1.2;letter-spacing:-.01em}
    .sheet .sheet-body{overflow:auto;display:flex;flex-direction:column;gap:10px;padding-right:4px;padding-bottom:calc(20px + env(safe-area-inset-bottom))}
    .sheet-media{width:100%;aspect-ratio:1.35;border:1px solid #eaf1ff;border-radius:16px;background:radial-gradient(600px 280px at 20% 0%,rgba(47,125,217,.12),transparent 60%),linear-gradient(180deg,#fff,#f5f9ff);margin-top:var(--s0);margin-bottom:var(--s1);overflow:hidden;display:block}
    .sheet-media img{width:100%;height:100%;object-fit:cover;display:block}
    .sheet-head{display:flex;flex-direction:column;gap:6px;align-items:flex-start;margin-top:0}
    .status-chip{display:inline-flex;align-items:center;gap:6px;border:1px solid #e6eaf6;border-radius:999px;padding:.25rem .55rem;font-weight:800;font-size:.8rem}
    .status-chip .dot{width:.5rem;height:.5rem;border-radius:50%}
    .status-chip.low{color:#b64848;border-color:#ffdede;background:#fff7f7}
    .status-chip.low .dot{background:#ffdede}
    .status-chip.soon{color:#1B5FB3;border-color:#cfe3ff;background:#f3f8ff}
    .status-chip.soon .dot{background:#cfe3ff}
    .status-chip.sold{color:#6b7280;border-color:#e3e4ea;background:#fafbfc}
    .status-chip.sold .dot{background:#dcdde3}

    .std-card{background:#fff;border:1px solid #e5ecff;border-radius:calc(var(--s2));padding:var(--s2);box-shadow:var(--shadow-soft)}
    .std-list{margin:0;padding-left:1.25rem;display:grid;gap:6px}

    /* ===== Organizadores ===== */
    .model-grid{display:grid;grid-template-columns:1fr;gap:var(--s1);margin-top:var(--s1)}
    @media(min-width:720px){.model-grid{grid-template-columns:repeat(2,1fr)}}
    .model{appearance:none;background:#fff;border:1px solid #e5ecff;border-radius:calc(var(--s1));padding:var(--s1);
      display:flex;align-items:center;justify-content:center;gap:.6rem;cursor:pointer;text-align:center;box-shadow:var(--shadow-soft);font-weight:800;transition:transform var(--t-fast),box-shadow var(--t-fast),border-color var(--t-fast)}
    .model[aria-checked="true"]{border-color:#e5ecff;box-shadow:var(--shadow-soft);transform:translateY(-1px) scale(1.02)}

    .fee-row{display:none;place-content:center;margin-top:4px}
    .fee-chip{display:inline-flex;align-items:center;gap:.5rem;padding:.45rem .8rem;border:1px solid #cfe0ff;border-radius:999px;background:#eef4ff;color:#2F7DD9;font-weight:800;box-shadow:var(--shadow-soft)}
    .fee-row.is-visible{display:grid}

    .org-panel{background:#fff;border:1px solid #e5ecff;border-radius:calc(var(--s2));padding:var(--s3);box-shadow:var(--shadow);margin-top:var(--s2)}
    .org-notice{margin-bottom:var(--s1);font-weight:700}
    .panel-grid{display:grid;grid-template-columns:1fr;gap:var(--s2)}
    @media(min-width:1020px){ .panel-grid{grid-template-columns:1.1fr .9fr} }
    .panel-card{background:#f9fbff;border:1px solid #e5ecff;border-radius:calc(var(--s1));padding:var(--s2)}
    #org-detail.is-disabled{opacity:.55;pointer-events:none}

    .cmd-list{display:grid;gap:8px}
    .line{display:flex;gap:10px;align-items:center}
    .grid{display:grid;gap:10px}
    .grid-2{grid-template-columns:1fr 1fr}
    .grid-3{grid-template-columns:repeat(3,1fr)}

    details.disclosure{border:0;padding:0;margin:0}
    .disclosure__summary{list-style:none;cursor:pointer;user-select:none;display:flex;align-items:center;justify-content:space-between;gap:.6rem;padding:.75rem 1rem;border:1px solid #e5ecff;border-radius:12px;background:#fff;box-shadow:var(--shadow-soft);font-weight:800;outline:none}
    .disclosure__summary::-webkit-details-marker{display:none}

    .calc{display:grid;gap:10px}
    .calc-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .calc input, .calc select, .calc textarea{width:100%;border:1px solid #e5ecff;border-radius:12px;padding:.7rem .8rem;font:inherit}
    .calc input:disabled, .calc select:disabled, .calc textarea:disabled{background:#f3f6ff;color:#8796b0}
    .calc small{color:var(--muted)}
    .calc-result{background:#fff;border:1px dashed #dbe5ff;border-radius:12px;padding:.75rem .9rem;font-weight:800;display:flex;justify-content:space-between;align-items:center}

    .panel-cta{display:grid;grid-template-columns:1fr;gap:var(--s1);margin-top:var(--s2)}
    @media(min-width:560px){.panel-cta{grid-template-columns:max-content max-content}}

    /* ===== Footer ===== */
    footer{background:#fff;border-top:1px solid #e7eefb;margin-top:var(--s4)}
    .foot{max-width:var(--container-max);margin:0 auto;padding:var(--s3) var(--s3)}
    .foot-block{display:grid;gap:var(--s2);justify-items:center;text-align:center}
    .link-row{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;margin-bottom:var(--s1)}
    .link-btn{width:44px;height:44px;display:grid;place-items:center;border:1px solid #e7eefb;background:#fff;border-radius:12px;box-shadow:var(--shadow-soft);color:#0b1220;padding:0}
    .link-btn svg{width:22px;height:22px;stroke:currentColor;fill:none;stroke-linecap:round;stroke-linejoin:round}
    .legal{display:flex;flex-wrap:wrap;gap:var(--s1);justify-content:center;margin-top:calc(var(--s0)*1.2)}
    .legal a{text-decoration:underline;font-weight:600}
    .foot-meta{display:flex;flex-wrap:wrap;gap:10px;align-items:center;color:#667792;justify-content:center}

    /* Print */
    @media print{
      header,footer,.cta-row,.toast,button.view{display:none!important}
      .container{max-width:100%;padding:0}
      .card,.panel-card,.std-card{box-shadow:none!important;border:1px solid #999!important}
      .status-line{color:#000!important}
      a:link,a:visited{text-decoration:underline;color:#000!important}
      a[href]:after{content:" <" attr(href) ">";font-size:.9em}
    }

    /* Small screens: lighten visual weight */
    @media (max-width: 380px){
      .card{box-shadow:var(--shadow-soft);padding:var(--s1)}
      .btn{padding:0 var(--s1)}
      .container{padding:0 var(--s2)}
    }

    /* Sheet close */
    .sheet-close{position:absolute; right:10px; top:10px;appearance:none; background:#fff; border:1px solid #ffd6d6; color:#c94747;border-radius:14px; padding:.8rem;display:grid; place-items:center;box-shadow:0 8px 20px rgba(201,71,71,.18);z-index:9999;touch-action:manipulation;cursor:pointer}
    .sheet-close:hover{background:#fff5f5}
    .sheet-close:active{filter:saturate(1.1)}
    .sheet-close svg{width:22px;height:22px;stroke:currentColor;pointer-events:none}
  </style>
</head>
<body>
  <header class="tech-header" role="banner">
    <div class="container nav"></div>
  </header>

  <main class="container" role="main">
    <section class="hero" aria-labelledby="hero-title">
      <div class="hero-brand">
        <img src="/logo_ingressai.png" alt="IngressAI" width="160" height="160" loading="eager" fetchpriority="high" />
        <div class="badges" aria-label="Selos de plataforma">
          <span class="badge" aria-label="Powered by Meta Business Platform">
            <img src="/meta.png" alt="Meta" width="24" height="24" loading="lazy" decoding="async" />
            <span>Powered by Meta Business Platform</span>
          </span>
          <span class="badge" aria-label="WhatsApp Business API">
            <img src="/whatsapp_business.png" alt="WhatsApp Business" width="24" height="24" loading="lazy" decoding="async" />
            <span>WhatsApp Business API</span>
          </span>
        </div>
      </div>
      <h1 id="hero-title">Crie eventos com a IngressAI.</h1>
    </section>

    <div class="cta-inline">
      <a href="#organizadores" class="btn btn--secondary btn--sm" id="cta-organizadores" aria-label="Abrir soluções para organizadores">Soluções para organizadores</a>
      <a href="/app/login" class="btn btn--ghost btn--sm" aria-label="Acessar dashboard">Acessar dashboard</a>
    </div>

    <section class="proofs" aria-labelledby="proofs-title">
      <h2 id="proofs-title" class="sr-only">Provas de valor</h2>
      <div class="features" aria-label="Provas de valor">
        <div class="feature">
          <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="3.6" y="6.6" width="16.8" height="10.8" rx="2.4" /><circle class="cut" cx="3.6" cy="12" r="1" /><circle class="cut" cx="20.4" cy="12" r="1" /><path class="bolt" d="M12 9.4 L10.2 12 h1.55 l-.75 3.0 L14 11.2 h-1.6 z" /></svg>
          <div class="meta"><strong>Venda automatizada</strong><small>via WhatsApp</small></div>
        </div>
        <div class="feature">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 10a 8 8 0 0 1 14-2" /><path d="M4 6v4h4" /><path d="M20 14a 8 8 0 0 1-14 2" /><path d="M20 18v-4h-4" /></svg>
          <div class="meta"><strong>Repasse imediato</strong><small>via Pix</small></div>
        </div>
        <div class="feature">
          <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="3" y="3" width="7" height="7" rx="1.1" /><rect class="qr-fill" x="5.6" y="5.6" width="2.8" height="2.8" rx=".35" /><rect x="14" y="3" width="7" height="7" rx="1.1" /><rect class="qr-fill" x="16.6" y="5.6" width="2.8" height="2.8" rx=".35" /></svg>
          <div class="meta"><strong>QR Code Antifraude</strong><small>+ validador web</small></div>
        </div>
        <div class="feature">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M9 7h11M9 12h11M9 17h11" /><rect x="4" y="6" width="2.2" height="2.2" rx=".35" /><rect x="4" y="11" width="2.2" height="2.2" rx=".35" /><rect x="4" y="16" width="2.2" height="2.2" rx=".35" /></svg>
          <div class="meta"><strong>Comandos &amp; Dashboard</strong><small>Compradores &amp; acesso</small></div>
        </div>
      </div>
    </section>

    <section id="vitrine" class="section" aria-labelledby="vitrine-title" tabindex="-1">
      <h2 id="vitrine-title">Eventos em destaque</h2>
      <div class="filters" aria-label="Filtros de eventos">
        <div class="search">
          <label for="busca-eventos" class="sr-only">Buscar evento</label>
          <input type="search" id="busca-eventos" placeholder="Buscar evento" inputmode="search" autocomplete="off" aria-describedby="vitrine-title" />
        </div>
        <div id="filtro-cidades" class="chips" role="radiogroup" aria-label="Filtrar por cidade"></div>
      </div>
      <div class="cards" id="lista-eventos" aria-live="polite"></div>
    </section>

    <!-- === ORGANIZADORES === -->
    <section id="organizadores" class="section" aria-labelledby="orgs-title" tabindex="-1" hidden>
      <h2 id="orgs-title">Soluções para organizadores</h2>
      <div id="std-card" class="std-card"></div>

      <!-- Modelos (duas categorias) -->
      <div id="org-models" class="model-grid" role="radiogroup" aria-label="Categorias de organizador"></div>
      <div class="fee-row" id="fee-row"><span class="fee-chip" id="fee-chip">Taxa</span></div>

      <div id="org-detail" class="org-panel is-disabled" role="region" tabindex="0" aria-live="polite">
        <div class="org-notice subtle" id="org-notice">Selecione uma categoria acima para liberar o Setup.</div>

        <div class="panel-grid">
          <!-- CARD: DASHBOARD -->
          <div class="panel-card">
            <details class="disclosure" open>
              <summary class="disclosure__summary">Dashboard</summary>
              <div class="grid" style="gap:12px">
                <p style="margin:0" class="subtle">
                  Controle tudo do seu evento no Dashboard: lotes, vendas, validação de ingressos e relatórios. 
                  O acesso é por <strong>número de telefone + código</strong> (enviado no Setup abaixo).
                </p>
                <div class="panel-cta">
                  <a class="btn btn--secondary" href="/app/login">Acessar dashboard</a>
                  <a class="btn btn--ghost" href="https://wa.me/5534999992747" target="_blank" rel="noopener noreferrer">Falar com suporte</a>
                </div>
              </div>
            </details>
          </div>

          <!-- CARD: CALCULADORA & SETUP -->
          <div class="panel-card">
            <details class="disclosure" open>
              <summary class="disclosure__summary">Calculadora &amp; Setup</summary>

              <div class="calc" id="calc-box" data-fee-fixed="">
                <!-- CALCULADORA -->
                <div class="calc-row">
                  <div>
                    <label for="preco">Preço</label>
                    <input id="preco" type="text" inputmode="decimal" placeholder="R$ 60,00" aria-label="Preço do ingresso" disabled />
                  </div>
                  <div>
                    <label for="qtd">Qtd</label>
                    <input id="qtd" type="number" placeholder="1" min="1" step="1" aria-label="Quantidade de ingressos" disabled />
                  </div>
                </div>
                <small id="calc-note">Selecione uma categoria acima para aplicar a taxa.</small>
                <div class="calc-result" id="calc-gross-row"><span>Total bruto</span><strong id="calc-gross">R$ 0,00</strong></div>
                <div class="calc-result" id="calc-fee-row"><span>Taxa da plataforma</span><strong id="calc-fee">R$ 0,00</strong></div>
                <div class="calc-result"><span>Você recebe</span><strong id="calc-net">R$ 0,00</strong></div>

                <hr style="border:none;border-top:1px dashed #dbe5ff;margin:.4rem 0" />

                <!-- SETUP DO EVENTO -->
                <div class="grid grid-2">
                  <div>
                    <label for="ev-nome">Nome do evento</label>
                    <input id="ev-nome" type="text" placeholder="Ex: Sunset da Atlética" disabled />
                  </div>
                  <div>
                    <label for="ev-cidade">Cidade</label>
                    <input id="ev-cidade" type="text" placeholder="Ex: Uberaba" disabled />
                  </div>
                </div>

                <div class="grid grid-3">
                  <div>
                    <label for="ev-data">Data</label>
                    <input id="ev-data" type="date" disabled />
                  </div>
                  <div>
                    <label for="ev-hora">Hora</label>
                    <input id="ev-hora" type="time" disabled />
                  </div>
                  <div>
                    <label for="ev-cap">Capacidade</label>
                    <input id="ev-cap" type="number" min="1" step="1" placeholder="Ex: 500" disabled />
                  </div>
                </div>

                <div class="grid">
                  <div>
                    <label for="ev-local">Local</label>
                    <input id="ev-local" type="text" placeholder="Ex: Espaço Central" disabled />
                  </div>
                  <div>
                    <label for="ev-desc">Descrição (opcional)</label>
                    <textarea id="ev-desc" rows="2" placeholder="Breve descrição…" disabled></textarea>
                  </div>
                </div>

                <small class="subtle" id="setup-note">Preencha os dados e solicite a criação. Você receberá um código para liberar o acesso no Dashboard.</small>

                <div class="grid grid-3" style="margin-top:6px">
                  <div>
                    <label for="ev-phone">Seu WhatsApp</label>
                    <input id="ev-phone" type="tel" inputmode="tel" placeholder="55DDDNNNNNNNN" disabled />
                  </div>
                  <div>
                    <label for="ev-code">Código</label>
                    <input id="ev-code" type="text" inputmode="numeric" placeholder="••••••" disabled />
                  </div>
                  <div class="line" style="margin-top:1.6rem">
                    <button type="button" class="btn btn--ghost btn--sm" id="setup-send-code" disabled>Enviar código</button>
                    <button type="button" class="btn btn--ghost btn--sm" id="setup-verify-code" disabled>Verificar</button>
                  </div>
                </div>

                <div class="panel-cta" style="margin-top:var(--s2)">
                  <button class="btn btn--secondary is-disabled" id="setup-submit" disabled>Solicitar criação</button>
                  <a class="btn btn--ghost" href="/app/login">Acessar dashboard</a>
                </div>

                <small id="setup-status" class="subtle" aria-live="polite"></small>
              </div>
            </details>
          </div>
        </div>
      </div>
    </section>

    <section id="como-funciona" class="section" aria-labelledby="como-title">
      <h2 id="como-title">Como funciona</h2>
      <div class="cards" style="grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:var(--s2)">
        <div class="card">
          <h3 class="card-title" style="font-size:clamp(1rem,2.4vw,1.2rem)">Para quem compra</h3>
          <ol style="margin:0;padding-left:var(--s2);display:grid;gap:calc(var(--s0)*1.1)">
            <li>Escolha o evento</li>
            <li>Pague com rapidez via WhatsApp</li>
            <li>Receba o ingresso com QR Code</li>
          </ol>
        </div>
        <div class="card">
          <h3 class="card-title" style="font-size:clamp(1rem,2.4vw,1.2rem)">Para quem organiza</h3>
          <ol style="margin:0;padding-left:var(--s2);display:grid;gap:calc(var(--s0)*1.1)">
            <li>Faça o Setup do evento</li>
            <li>Verifique o código</li>
            <li>Acesse o Dashboard</li>
            <li>Publique e valide na entrada</li>
          </ol>
        </div>
      </div>
    </section>

    <div class="sheet-backdrop" id="sheet-backdrop" aria-hidden="true"></div>
    <aside class="sheet" id="sheet" aria-hidden="true" role="dialog" aria-modal="true">
      <button type="button" class="sheet-close" id="sheet-close" data-close="sheet" aria-label="Fechar detalhes">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M6 6L18 18M18 6L6 18" />
        </svg>
      </button>
      <div class="sheet-body" id="sheet-body"></div>
    </aside>
  </main>

  <footer role="contentinfo">
    <div class="foot">
      <div class="foot-block">
        <div class="link-row" aria-label="Canais de contato">
          <a class="link-btn" href="mailto:contato@ingressai.chat" aria-label="Enviar e-mail">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="5" width="18" height="14" rx="2"></rect><path d="M4 6l8 6 8-6"></path></svg>
          </a>
          <a class="link-btn" href="https://instagram.com/ingressai" target="_blank" rel="noopener noreferrer" aria-label="Abrir Instagram">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="4"></rect><circle cx="12" cy="12" r="5"></circle><circle cx="17" cy="7" r="1.2" fill="currentColor" stroke="none"></circle></svg>
          </a>
          <a class="link-btn" href="https://wa.me/5534999992747" target="_blank" rel="noopener noreferrer" aria-label="Falar com o bot no WhatsApp">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 90 90" aria-hidden="true" focusable="false"><path d="M0.576 44.596C0.573 52.456 2.626 60.129 6.53 66.892L0.201 90l23.65-6.201c6.516 3.553 13.852 5.426 21.318 5.429h0.019c24.586 0 44.601-20.009 44.612-44.597 0.004-11.917-4.633-23.122-13.055-31.552C68.321 4.65 57.121 0.005 45.188 0 20.597 0 0.585 20.005 0.575 44.595m14.083 21.132l-0.883-1.402c-3.712-5.902-5.671-12.723-5.669-19.726C8.115 24.161 24.748 7.532 45.201 7.532c9.905 0.004 19.213 3.865 26.215 10.871 7.001 7.006 10.854 16.32 10.851 26.224-0.009 20.439-16.643 37.068-37.08 37.068h-0.015c-6.655-0.004-13.181-1.79-18.872-5.168l-1.355-0.803-14.035 3.68 4.956-13.937z" fill="currentColor"/><path d="M34.038 25.95c-0.835-1.856-1.714-1.894-2.508-1.926-0.65-0.028-1.394-0.026-2.136-0.026-0.744 0-1.951 0.279-2.972 1.394-1.022 1.116-3.902 3.812-3.902 9.296 0 5.485 3.995 10.784 4.551 11.529 0.558 0.743 7.712 12.357 19.041 16.825 9.416 3.713 11.333 2.975 13.376 2.789 2.044-0.186 6.595-2.696 7.524-5.299 0.929-2.603 0.929-4.834 0.651-5.299-0.279-0.465-1.022-0.744-2.137-1.301-1.115-0.558-6.595-3.254-7.617-3.626-1.022-0.372-1.765-0.557-2.509 0.559-0.743 1.115-2.878 3.625-3.528 4.368-0.65 0.745-1.301 0.838-2.415 0.28-1.115-0.559-4.705-1.735-8.964-5.532-3.314-2.955-5.551-6.603-6.201-7.719-0.65-1.115-0.069-1.718 0.489-2.274 0.501-0.499 1.115-1.301 1.673-1.952 0.556-0.651 0.742-1.116 1.113-1.859 0.372-0.744 0.186-1.395-0.093-1.953-0.805-1.58-2.971-7.092-3.962-9.296" fill="currentColor"/></svg>
          </a>
        </div>
        <div class="legal" aria-label="Links legais">
          <a href="/politica.html">Política de privacidade</a>
          <a href="/termos.html">Termos de uso</a>
          <a href="/excluir.html">Excluir meus dados</a>
        </div>
        <div class="foot-meta" aria-label="Informações">
          <strong>IngressAI</strong>
          <span>•</span>
          <span>CNPJ 42.948.399/0001-87</span>
        </div>
      </div>
    </div>
  </footer>

  <script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"IngressAI","url":"https://ingressai.chat/","logo":"https://ingressai.chat/logo_ingressai.png","sameAs":["https://instagram.com/ingressai"],"contactPoint":[{"@type":"ContactPoint","contactType":"customer support","areaServed":"BR","availableLanguage":"pt-BR"}]}</script>

  <script>
    /* ========= CONFIG ========= */
    const API_PARAM = new URLSearchParams(location.search).get('api');
    const BASE = (API_PARAM || "https://ingressai-backend-production.up.railway.app").replace(/\/$/, "");
    const WHATSAPP_NUMBER='5534999992747';

    /* ========= ESTADO ========= */
    let eventos = [];
    let evIndex = {};

    /* ========= HELPERS ========= */
    const esc = s => String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;'}[m]));
    function formatDate(iso){try{const d=new Date(iso);return d.toLocaleString('pt-BR',{dateStyle:'medium',timeStyle:'short'})}catch{return iso}}
    function waHref(text){return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`}
    function animatePress(el){try{el.classList.add('btn-press');el.addEventListener('animationend',()=>el.classList.remove('btn-press'),{once:true})}catch{}}
    function smoothGoTo(id){const target=document.getElementById(id);if(!target)return;const reduced=window.matchMedia('(prefers-reduced-motion: reduce)').matches;target.scrollIntoView({behavior:reduced?'auto':'smooth',block:'start'});try{target.focus({preventScroll:true})}catch{}}
    function abs(u){
      try{
        if(!u) return '';
        if(/^https?:\/\//i.test(u)) return u;
        if(u.startsWith('//')) return location.protocol + u;
        if(u.startsWith('/')) return BASE + u;
        return BASE + '/' + u.replace(/^\/+/,'');
      }catch{ return u || ''; }
    }
    async function fetchJson(url, opts){
      const r = await fetch(url, {
        headers: { 'Accept':'application/json', ...(opts&&opts.headers||{}) },
        cache: 'no-store',
        ...opts
      });
      let j = null; try { j = await r.json(); } catch {}
      if (!r.ok) throw new Error(j?.error || r.statusText || 'Request failed');
      return j;
    }
    function moneyBR(v){try{return new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(v||0)}catch{return 'R$ '+(v||0).toFixed(2).replace('.',',')}}

    /* ========= DOM ========= */
    const lista=document.getElementById('lista-eventos');
    const inputBusca=document.getElementById('busca-eventos');
    const chipsRow=document.getElementById('filtro-cidades');
    const std=document.getElementById('std-card');
    const modelsBox=document.getElementById('org-models');
    const feeRow=document.getElementById('fee-row');
    const feeChip=document.getElementById('fee-chip');
    const detail=document.getElementById('org-detail');
    const orgNotice=document.getElementById('org-notice');
    const calcBox=document.getElementById('calc-box');
    const calcNote=document.getElementById('calc-note');
    const calcNet=document.getElementById('calc-net');
    const calcGross=document.getElementById('calc-gross');
    const calcFee=document.getElementById('calc-fee');
    const setupStatus=document.getElementById('setup-status');
    const sheet=document.getElementById('sheet');
    const sheetBody=document.getElementById('sheet-body');
    const sheetBackdrop=document.getElementById('sheet-backdrop');

    /* ========= Header + micro-animação ========= */
    document.addEventListener('click',e=>{const el=e.target.closest('.btn,.view');if(el)animatePress(el)});
    (function(){const hero=document.querySelector('.hero');const header=document.querySelector('header');const HIDE_START=16,HIDE_END=240;let ticking=false;function onScroll(){if(ticking)return;ticking=true;requestAnimationFrame(()=>{const y=window.scrollY||document.documentElement.scrollTop||0;header&&header.classList.toggle('is-scrolled',y>8);const p=Math.min(1,Math.max(0,(y-HIDE_START)/(HIDE_END-HIDE_START)));if(hero){hero.style.setProperty('--hero-p',p.toFixed(3));hero.classList.toggle('is-hidden',p>=1)}ticking=false})}onScroll();window.addEventListener('scroll',onScroll,{passive:true})})();

    /* ========= CTA Organizadores (robusto) ========= */
    function initOrganizadores(){
      const sec=document.getElementById('organizadores');
      const cta=document.getElementById('cta-organizadores');
      const openOrganizadores=()=>{ if(sec && sec.hasAttribute('hidden')) sec.removeAttribute('hidden'); smoothGoTo('organizadores'); };

      // Listener direto do botão
      if (cta) {
        cta.addEventListener('click', (e)=>{
          const href = cta.getAttribute('href') || '';
          if (href.startsWith('#organizadores')) {
            e.preventDefault();
            openOrganizadores();
            try { history.pushState({}, '', '#organizadores'); } catch {}
          }
        });
      }

      // Delegação: qualquer link com hash #organizadores
      document.addEventListener('click', (e)=>{
        const a = e.target.closest('a[href^="#organizadores"]');
        if(!a) return;
        e.preventDefault();
        openOrganizadores();
        try { history.pushState({}, '', '#organizadores'); } catch {}
      });

      // Abertura por hash direto ou navegação
      if (location.hash === '#organizadores') openOrganizadores();
      window.addEventListener('hashchange', ()=>{ if (location.hash === '#organizadores') openOrganizadores(); });
    }
    if (document.readyState !== 'loading') initOrganizadores();
    else document.addEventListener('DOMContentLoaded', initOrganizadores);

    /* ========= VITRINE ========= */
    const MAIN_CITIES=['Uberaba','Uberlândia','Belo Horizonte','Ribeirão Preto','Franca'];
    let selectedCity='Todas';
    let query='';

    function normalizeStatusLabel(s){if(!s)return'';return s.replace('Últimos ingressos','Último lote')}
    function filterEventos(data,q,city){
      const qn=(q||'').trim().toLowerCase();
      const citySel=city||'Todas';
      return data.filter(ev=>{
        const evCidade=(ev.cidade||'').toLowerCase();
        const matchCity=citySel==='Todas'?true:evCidade===citySel.toLowerCase();
        const nome=(ev.nome||'').toLowerCase();
        const desc=(ev.descricao||'').toLowerCase();
        const matchQuery=!qn?true:(nome.includes(qn)||desc.includes(qn));
        return matchCity&&matchQuery
      })
    }
    function buildChips(){
      chipsRow.innerHTML='';
      const cities=Array.from(new Set(MAIN_CITIES.concat(eventos.map(e=>e.cidade).filter(Boolean))));
      ['Todas',...cities].forEach(c=>{
        const btn=document.createElement('button');
        btn.className='chip';btn.type='button';btn.textContent=c;
        btn.setAttribute('role','radio');
        btn.setAttribute('aria-checked',c===selectedCity?'true':'false');
        btn.dataset.city=c;chipsRow.appendChild(btn)
      })
    }
    function renderCards(){
      const data=filterEventos(eventos,query,selectedCity);
      lista.innerHTML='';
      if (!data.length){
        const empty=document.createElement('div');
        empty.className='std-card';
        empty.innerHTML='<strong>Sem eventos publicados ainda.</strong><br><span class="subtle">Volte em breve — estamos preparando novidades ✨</span>';
        lista.appendChild(empty);
        return;
      }
      data.forEach(ev=>{
        const statusLabel=normalizeStatusLabel(ev.status||'');
        const statusKey=statusLabel==='Esgotado'?'sold':(statusLabel==='Último lote'?'low':'soon');
        const card=document.createElement('article');
        card.className='card';
        card.dataset.open=ev.id;
        card.setAttribute('role','button');
        card.setAttribute('tabindex','0');
        card.setAttribute('aria-labelledby',`card-title-${esc(ev.id)}`);
        card.innerHTML=`
          <div class="card-media">${
            ev.img
              ? `<img src="${esc(ev.img)}" width="800" height="592" alt="Imagem do evento ${esc(ev.nome)}" loading="lazy" decoding="async" referrerpolicy="no-referrer"
                   onerror="this.closest('.card-media').textContent='Mídia do evento'; this.remove();">`
              : 'Mídia do evento'
          }</div>
          <div class="card-header">
            <div>
              <div class="card-title" id="card-title-${esc(ev.id)}">${esc(ev.nome)}</div>
              <div class="card-city">${esc(ev.cidade || '')}</div>
              <div class="status-line status--${statusKey}">
                <span class="status-dot" aria-hidden="true"></span>
                <span class="status-label">${esc(statusLabel || 'Em breve')}</span>
              </div>
            </div>
            <button type="button" class="view" data-open="${esc(ev.id)}" aria-label="Ver detalhes de ${esc(ev.nome)}">Ver detalhes</button>
          </div>`;
        lista.appendChild(card)
      })
    }

    chipsRow.addEventListener('click',e=>{
      const b=e.target.closest('button.chip');if(!b)return;
      selectedCity=b.dataset.city;
      chipsRow.querySelectorAll('button.chip').forEach(x=>x.setAttribute('aria-checked','false'));
      b.setAttribute('aria-checked','true');
      renderCards()
    });
    let debounce;inputBusca.addEventListener('input',()=>{clearTimeout(debounce);debounce=setTimeout(()=>{query=inputBusca.value;renderCards()},180)});

    function buildStatusChip(statusLabel){
      const key=statusLabel==='Esgotado'?'sold':(statusLabel==='Último lote'?'low':'soon');
      const lbl=esc(statusLabel||'Em breve');
      return `<span class="status-chip ${key}"><span class="dot" aria-hidden="true"></span>${lbl}</span>`
    }

    /* ========= Bottom Sheet + focus trap ========= */
    const main = document.querySelector('main');
    let lastFocus = null;
    function trapFocus(el){
      const FOCUSABLE='a,button,input,textarea,select,[tabindex]:not([tabindex="-1"])';
      const nodes = Array.from(el.querySelectorAll(FOCUSABLE)).filter(n=>!n.disabled && n.offsetParent!==null);
      function onKey(e){
        if(e.key!=='Tab' || nodes.length===0) return;
        const first = nodes[0], last = nodes[nodes.length-1];
        if (e.shiftKey && document.activeElement===first){ e.preventDefault(); last.focus(); }
        else if (!e.shiftKey && document.activeElement===last){ e.preventDefault(); first.focus(); }
      }
      el.addEventListener('keydown', onKey, { signal: (el._trapCtl=new AbortController()).signal });
    }

    function openSheet(ev){
      ev = ev || {};
      const nome = ev.nome || 'Evento';
      const cidade = ev.cidade || '';
      const dataISO = ev.dataISO || '';
      const localNome = ev.localNome || 'Local a confirmar';
      const localUrl = ev.localUrl || '';
      const descricao = ev.descricao || nome;
      const statusLabel = normalizeStatusLabel(ev.status || '');
      const sold = statusLabel === 'Esgotado';

      sheetBody.innerHTML='';

      const media=document.createElement('div');
      media.className='sheet-media';
      if(ev.img){
        const img=document.createElement('img');
        img.src=ev.img; img.alt='Imagem do evento '+nome; img.loading='lazy'; img.decoding='async'; img.referrerPolicy='no-referrer';
        img.onerror=()=>{ media.textContent='Mídia do evento'; img.remove(); };
        media.appendChild(img);
      } else {
        media.textContent='Mídia do evento';
      }

      const head=document.createElement('div');
      head.className='sheet-head';
      const h3=document.createElement('h3'); h3.id='sheet-title'; h3.textContent=`${nome} — ${cidade}`;
      head.appendChild(h3);
      const chip=document.createElement('div'); chip.innerHTML=buildStatusChip(statusLabel); head.appendChild(chip);

      const meta1=document.createElement('div');
      meta1.className='meta-line';
      meta1.innerHTML=`<strong>Data:</strong> <span>${dataISO ? esc(formatDate(dataISO)) : 'A confirmar'}</span>`;

      const meta2=document.createElement('div');
      meta2.className='meta-line';
      meta2.innerHTML= localUrl
        ? `<strong>Local:</strong> <a href="${esc(localUrl)}" target="_blank" rel="noopener noreferrer">${esc(localNome)}</a>`
        : `<strong>Local:</strong> <span>${esc(localNome)}</span>`;

      const meta3=document.createElement('div');
      meta3.className='meta-line';
      meta3.innerHTML=`<strong>Categoria:</strong> <span>${esc(ev.categoria || 'IngressAI')}</span>`;

      const desc=document.createElement('p');
      desc.className='subtle';
      desc.textContent=descricao;

      const actions=document.createElement('div');
      actions.className='actions';
      if(sold){
        actions.innerHTML=`<span class="status-line status--sold"><span class="status-dot" aria-hidden="true"></span><span class="status-label">Esgotado</span></span><a class="btn btn--secondary btn--sm" href="#vitrine">Ver outros eventos</a>`;
      }else{
        actions.innerHTML=`
          <a class="btn btn--secondary btn--sm"
             href="${waHref(`ingressai:start ev=${esc(ev.id)}`)}"
             target="_blank" rel="noopener">
            Comprar pelo WhatsApp
          </a>`;
      }

      sheetBody.replaceChildren(media, head, meta1, meta2, meta3, desc, actions);

      // focus + backdrop
      lastFocus = document.activeElement;
      main.setAttribute('aria-hidden','true');
      sheet.setAttribute('aria-hidden','false');
      sheet.setAttribute('aria-labelledby','sheet-title');
      sheetBackdrop.setAttribute('aria-hidden','false');
      sheet.classList.add('is-open');
      sheetBackdrop.classList.add('is-open');
      document.body.style.overflow='hidden';
      trapFocus(sheet);

      try { history.pushState({ ev: ev.id }, '', '#ev=' + encodeURIComponent(ev.id)); } catch {}
      try { h3.focus({ preventScroll:true }); } catch {}
    }

    function closeSheetSafe(e){
      try{ e && e.preventDefault && e.preventDefault(); }catch{}
      sheet.classList.remove('is-open');
      sheetBackdrop.classList.remove('is-open');
      sheet.removeAttribute('aria-labelledby');
      sheet.setAttribute('aria-hidden','true');
      sheetBackdrop.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
      main.removeAttribute('aria-hidden');
      try { sheet._trapCtl?.abort(); } catch {}
      if (location.hash.startsWith('#ev=')) {
        try { history.replaceState({}, '', location.pathname + location.search); } catch {}
      }
      lastFocus?.focus?.();
    }
    document.addEventListener('click', (e)=>{ const btn = e.target.closest('[data-close="sheet"]'); if(btn) closeSheetSafe(e); });
    sheetBackdrop?.addEventListener('click', closeSheetSafe);
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && sheet?.classList?.contains('is-open')) closeSheetSafe(e); });
    window.addEventListener('popstate', () => { if (!location.hash.startsWith('#ev=')) closeSheetSafe(); });

    const listaEl=document.getElementById('lista-eventos');
    listaEl.addEventListener('click',e=>{const btn=e.target.closest('[data-open]');if(!btn)return;const ev=evIndex[btn.dataset.open];if(!ev)return;openSheet(ev)});
    listaEl.addEventListener('click',e=>{const card=e.target.closest('article.card[data-open]');if(!card)return; if (e.target.closest('.view')) return; const ev=evIndex[card.dataset.open]; if(!ev)return; openSheet(ev)});
    listaEl.addEventListener('keydown',e=>{
      const card=e.target.closest('article.card[data-open]');
      if(!card) return;
      if(e.key==='Enter' || e.key===' '){
        e.preventDefault();
        const ev=evIndex[card.dataset.open]; if(!ev)return; openSheet(ev);
      }
    });

    /* ========= ORGANIZADORES ========= */
    const commonFeatures=[
      'Setup do evento direto no site',
      'Verificação por código e acesso ao Dashboard',
      'Geração automática de ingresso com QR Code',
      'Link público de vendas e acompanhamento em tempo real',
      'Repasse na hora ao organizador',
      'Validador web liberado ao criar',
      'Lista de compradores atualizada'
    ];
    std.innerHTML='<ul class="std-list">'+commonFeatures.map(f=>'\n<li>'+esc(f)+'</li>').join('')+'</ul>';

    // DUAS categorias (taxa fixa por ingresso)
    const categorias=[
      {key:'aret', title:'Atléticas & Repúblicas', feeLabel:'R$ 2,00 por ingresso', feeFixed:2.00},
      {key:'proloc', title:'Produtoras & Locais independentes', feeLabel:'R$ 2,50 por ingresso', feeFixed:2.50}
    ];
    modelsBox.innerHTML=categorias.map(m=>'<button type="button" class="model" role="radio" aria-checked="false" data-key="'+esc(m.key)+'">'+esc(m.title)+'</button>').join('');

    const BRL=new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'});
    const parseBR=v=>Number(String(v).replace(/[^\d,.-]/g,'').replace(/\./g,'').replace(',', '.'))||0;
    const money=v=>BRL.format(isFinite(v)?v:0);
    function computeGross(preco,qtd){return Math.max(0,Number(preco)||0)*Math.max(1,parseInt(qtd||1,10))}
    function computeFeeFixed(qtd,feeFixed){return Math.max(1,parseInt(qtd||1,10)) * Math.max(0,Number(feeFixed)||0)}
    function computeNet(preco,qtd,feeFixed){const bruto=computeGross(preco,qtd);const taxa=computeFeeFixed(qtd,feeFixed);return {bruto,taxa,liquido: Math.max(0, Number((bruto - taxa).toFixed(2)))}}

    function enableSetupFields(enable){
      ['preco','qtd','ev-nome','ev-cidade','ev-data','ev-hora','ev-cap','ev-local','ev-desc','ev-phone','ev-code']
        .forEach(id=>{const el=document.getElementById(id); if (!el) return; el.disabled = !enable;});
      ['setup-send-code','setup-verify-code','setup-submit'].forEach(id=>{
        const el=document.getElementById(id);
        if (!el) return;
        el.disabled = !enable;
        el.classList.toggle('is-disabled', !enable);
      });
    }

    function setStatus(msg,type){
      setupStatus.textContent = msg || '';
      setupStatus.style.color = type==='error' ? '#b64848' : type==='ok' ? '#1B5FB3' : '';
    }

    function getSetupPayload(){
      const nome = document.getElementById('ev-nome').value.trim();
      const cidade = document.getElementById('ev-cidade').value.trim();
      const data = document.getElementById('ev-data').value;
      const hora = document.getElementById('ev-hora').value;
      const cap = parseInt(document.getElementById('ev-cap').value||'0',10);
      const local = document.getElementById('ev-local').value.trim();
      const desc = document.getElementById('ev-desc').value.trim();
      const preco = parseBR(document.getElementById('preco').value||'0');
      const qtd = Math.max(1, parseInt(document.getElementById('qtd').value||'1',10));
      const feeFixed = Number(calcBox.dataset.feeFixed)||0;
      const categoriaKey = calcBox.dataset.planKey || '';
      const startISO = (data && hora) ? new Date(`${data}T${hora}:00`).toISOString() : '';
      return { nome, cidade, startISO, capacidade:cap, local, descricao:desc, preco, qtd, feeFixed, categoriaKey };
    }

    async function applyPlan(key){
      const plan=categorias.find(x=>x.key===key)||null;
      calcBox.dataset.planKey = plan ? plan.key : '';
      if(plan){
        feeChip.textContent='Taxa fixa ' + plan.feeLabel;
        feeRow.classList.add('is-visible');
        orgNotice.classList.add('is-hidden');
        detail.classList.remove('is-disabled');
        calcBox.dataset.feeFixed = String(plan.feeFixed);
        calcNote.innerHTML='Taxa aplicada: <strong>'+esc(plan.feeLabel)+'</strong>. O restante é repassado ao organizador na hora.';
        enableSetupFields(true);
      } else {
        feeRow.classList.remove('is-visible');
        orgNotice.classList.remove('is-hidden');
        detail.classList.add('is-disabled');
        calcBox.dataset.feeFixed = '';
        calcNote.textContent='Selecione uma categoria acima para aplicar a taxa.';
        enableSetupFields(false);
      }

      // listeners da calculadora (idempotentes)
      const precoEl=document.getElementById('preco');
      const qtdEl=document.getElementById('qtd');
      const recompute=()=>{
        const feeFixed=Number(calcBox.dataset.feeFixed)||0;
        const p=parseBR(precoEl.value||'0');
        const q=Math.max(1,parseInt(qtdEl.value||'1',10));
        const {bruto,taxa,liquido}=computeNet(p,q,feeFixed);
        calcGross.textContent=money(bruto);
        calcFee.textContent=money(taxa);
        calcNet.textContent=money(liquido);
      };
      precoEl.oninput = recompute;
      qtdEl.oninput   = recompute;
      recompute();

      // Ações de verificação e criação (ENDPOINTS ALINHADOS)
      const btnSend = document.getElementById('setup-send-code');
      const btnVerify = document.getElementById('setup-verify-code');
      const btnSubmit = document.getElementById('setup-submit');
      const phoneEl = document.getElementById('ev-phone');
      const codeEl  = document.getElementById('ev-code');

      calcBox.dataset.verified = 'false';

      btnSend.onclick = async ()=>{
        try{
          const phone = (phoneEl.value||'').trim();
          if(!phone){ setStatus('Informe o WhatsApp no formato 55DDDNNNNNNNN.', 'error'); return; }
          setStatus('Enviando código…');
          try{
            await fetchJson(`${BASE}/auth/request-code`, {
              method:'POST', headers:{'Content-Type':'application/json'},
              body: JSON.stringify({ phone })
            });
            setStatus('Código enviado. Confira seu WhatsApp.', 'ok');
          } catch {
            const msg = `ingressai:setup start phone=${phone}`;
            window.open(waHref(msg),'_blank','noopener');
            setStatus('Abrimos seu WhatsApp para confirmar o envio do código.', 'ok');
          }
        }catch(err){ setStatus('Falha ao enviar código.', 'error'); }
      };

      btnVerify.onclick = async ()=>{
        try{
          const phone=(phoneEl.value||'').trim();
          const code=(codeEl.value||'').trim();
          if(!phone||!code){ setStatus('Informe WhatsApp e o código recebido.', 'error'); return; }
          setStatus('Verificando código…');
          try{
            const j = await fetchJson(`${BASE}/auth/verify`, {
              method:'POST', headers:{'Content-Type':'application/json'},
              body: JSON.stringify({ phone, code })
            });
            if(j?.ok){ calcBox.dataset.verified='true'; setStatus('Código verificado! Você já pode solicitar a criação.', 'ok'); }
            else throw new Error('Código inválido');
          }catch{
            const msg = `ingressai:setup verify phone=${phone} code=${code}`;
            window.open(waHref(msg),'_blank','noopener');
            calcBox.dataset.verified='true';
            setStatus('Verificação feita pelo WhatsApp. Você já pode solicitar a criação.', 'ok');
          }
        }catch(err){ setStatus('Não foi possível verificar o código.', 'error'); }
      };

      btnSubmit.onclick = async ()=>{
        const verified = calcBox.dataset.verified==='true';
        const p = getSetupPayload();

        if(!p.nome || !p.cidade || !p.startISO){
          setStatus('Preencha nome, cidade, data e hora.', 'error'); return;
        }
        if(p.preco<=0){ setStatus('Informe um preço válido.', 'error'); return; }
        const phone = phoneEl.value.trim();
        if(!phone){ setStatus('Informe seu WhatsApp para vincular ao Dashboard.', 'error'); return; }

        setStatus('Enviando solicitação de criação…');

        try{
          const j = await fetchJson(`${BASE}/org/setup/submit`, {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({
              title: p.nome,
              city: p.cidade,
              venue: p.local,
              dateISO: p.startISO,
              priceNum: p.preco,
              category: p.categoriaKey === 'aret' ? 'aret' : 'prod',
              phone,
              verified
            })
          });
          if(j?.ok){
            setStatus('Evento pré-aprovado! Código enviado no WhatsApp. Faça login no Dashboard.', 'ok');
            try { location.href = '/app/login'; } catch {}
            return;
          }
          throw new Error('submit failed');
        } catch {
          const msg =
`ingressai:setup create
categoria=${p.categoriaKey}
nome=${p.nome}
cidade=${p.cidade}
quando=${p.startISO}
local=${p.local}
capacidade=${p.capacidade}
preco=${p.preco}
qtd=${p.qtd}
taxa_fixa=${p.feeFixed}
descricao=${p.descricao || '-'}
verificado=${verified}`;
          window.open(waHref(msg),'_blank','noopener');
          setStatus('Abrimos seu WhatsApp com o resumo para criação rápida.', 'ok');
        }
      };
    }

    modelsBox.addEventListener('click',e=>{
      const b=e.target.closest('button.model');if(!b)return;
      modelsBox.querySelectorAll('button.model').forEach(x=>x.setAttribute('aria-checked','false'));
      b.setAttribute('aria-checked','true');applyPlan(b.dataset.key)
    });
    applyPlan(null);

    /* ========= FETCH /events + FALLBACK ========= */
    async function fetchEventosDoBackend() {
      let items = [];
      try {
        const j = await fetchJson(`${BASE}/events`);
        if (Array.isArray(j)) items = j;
        else if (Array.isArray(j?.items)) items = j.items;
        else if (Array.isArray(j?.events)) items = j.events;
        else if (j?.events) items = Object.values(j.events).flat();
      } catch (e) {
        console.warn('events load failed', e);
      }

      const mapped = (items || []).map(e => {
        const IMG_RAW = e.imageUrl || (e.media && e.media.url) || e.image || e.bannerUrl || '';
        const IMG = abs(IMG_RAW);
        return {
          id: String(e.id),
          nome: e.title || e.nome || 'Evento',
          cidade: e.city || e.cidade || '',
          dataISO: e.date || e.startsAt || e.dataISO || new Date().toISOString(),
          localNome: e.venue || e.local || '',
          localUrl: 'https://maps.google.com/?q=' + encodeURIComponent(`${e.venue||e.local||''} ${e.city||e.cidade||''}`),
          categoria: e.category || 'IngressAI',
          status: e.statusLabel || 'Em breve',
          descricao: e.description || e.title || e.nome || '',
          img: IMG
        };
      });

      const fallback = [{
        id: 'hello-world-uberaba',
        nome: 'Hello World — Uberaba',
        cidade: 'Uberaba',
        dataISO: new Date(Date.now()+2*24*60*60*1000).toISOString(),
        localNome: 'Espaço Central',
        localUrl: 'https://maps.google.com/?q=' + encodeURIComponent('Espaço Central Uberaba'),
        categoria: 'IngressAI',
        status: 'Último lote',
        descricao: 'Hello World — Uberaba',
        img: ''
      }];

      eventos = mapped.length ? mapped : fallback;
      evIndex = Object.fromEntries(eventos.map(e=>[e.id,e]));
    }

    /* ========= INIT ========= */
    (async () => {
      await fetchEventosDoBackend();
      buildChips();
      renderCards();

      if (location.hash.startsWith('#ev=')) {
        const id = decodeURIComponent(location.hash.slice(4));
        const ev = evIndex[id];
        if (ev) openSheet(ev);
      }

      try {
        const nodes = eventos.map(ev=>({
          "@context":"https://schema.org","@type":"Event","name":ev.nome,"startDate":ev.dataISO,
          "eventAttendanceMode":"https://schema.org/OfflineEventAttendanceMode","eventStatus":"https://schema.org/EventScheduled",
          "location":{"@type":"Place","name":ev.localNome,"address":ev.cidade,"url":ev.localUrl},
          "organizer":{"@type":"Organization","name":"IngressAI","url":"https://ingressai.chat/"}
        }));
        if (nodes.length){
          const script=document.createElement('script');
          script.type='application/ld+json';
          script.textContent=JSON.stringify(nodes);
          document.head.appendChild(script);
        }
      } catch {}
    })();
  </script>
</body>
</html>
