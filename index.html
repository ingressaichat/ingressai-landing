// src/index.js
import React, { useEffect, useMemo, useRef, useState } from "react";
import { createRoot } from "react-dom/client";
import {
  BrowserRouter,
  Routes,
  Route,
  Link,
  useLocation,
  useNavigate,
  useParams,
  Navigate,
} from "react-router-dom";

/**
 * =========================================================
 * IngressAI - Landing Single File (index.js)
 * =========================================================
 * - Mantém tudo em um único arquivo como no seu padrão original “grandão”.
 * - Rotas: /, /login, /events, /events/:id, /tickets, /validator, /privacy, /terms
 * - UI: Navbar, Footer, várias seções, CTA, Modais, Toasts, Loader
 * - API: base configurável por env (Vite/CRA) com fallback /api
 * - Estado: hooks simples + utilitários (useFetch, useDebounced, useLocalStorage)
 * - Acessibilidade: rótulos, aria-* básicos, foco em modais
 */

// -----------------------------
// Config de API e helpers globais
// -----------------------------
const API_BASE =
  (typeof import.meta !== "undefined" && import.meta.env?.VITE_API_BASE) ||
  (typeof process !== "undefined" && process.env?.REACT_APP_API_BASE) ||
  "/api";

const IS_DEV =
  (typeof import.meta !== "undefined" && import.meta.env?.MODE === "development") ||
  (typeof process !== "undefined" && process.env?.NODE_ENV === "development");

// -----------------------------
// Hooks utilitários
// -----------------------------
function useDebounced(value, delay = 400) {
  const [v, setV] = useState(value);
  useEffect(() => {
    const t = setTimeout(() => setV(value), delay);
    return () => clearTimeout(t);
  }, [value, delay]);
  return v;
}

function useLocalStorage(key, initialValue) {
  const [val, setVal] = useState(() => {
    try {
      const raw = localStorage.getItem(key);
      return raw != null ? JSON.parse(raw) : initialValue;
    } catch {
      return initialValue;
    }
  });
  useEffect(() => {
    try {
      localStorage.setItem(key, JSON.stringify(val));
    } catch {}
  }, [key, val]);
  return [val, setVal];
}

function useFetch(url, opts) {
  const [state, set] = useState({ data: null, loading: true, error: null });
  useEffect(() => {
    let alive = true;
    set((s) => ({ ...s, loading: true, error: null }));
    fetch(url, {
      credentials: "include",
      headers: { "Content-Type": "application/json" },
      ...opts,
    })
      .then(async (r) => {
        const ct = r.headers.get("content-type") || "";
        const payload = ct.includes("application/json") ? await r.json() : await r.text();
        if (!r.ok) throw new Error(payload?.error || r.statusText);
        if (alive) set({ data: payload, loading: false, error: null });
      })
      .catch((e) => alive && set({ data: null, loading: false, error: e.message || "Erro" }));
    return () => {
      alive = false;
    };
  }, [url]);
  return state;
}

// -----------------------------
// UI genérica (Badge, Button, Card, Container, Section, Toast, Modal)
// -----------------------------
function cls(...xs) {
  return xs.filter(Boolean).join(" ");
}

function Container({ children, wide }) {
  return (
    <div
      style={{
        maxWidth: wide ? 1200 : 1024,
        margin: "0 auto",
        padding: "24px",
      }}
    >
      {children}
    </div>
  );
}

function Section({ id, title, subtitle, children, bg }) {
  return (
    <section id={id} style={{ background: bg ? bg : "transparent", padding: "56px 0" }}>
      <Container>
        {title && <h2 style={{ margin: "0 0 8px", fontSize: 28 }}>{title}</h2>}
        {subtitle && <p style={{ margin: "0 0 20px", color: "#555" }}>{subtitle}</p>}
        {children}
      </Container>
    </section>
  );
}

function Badge({ children, tone = "default" }) {
  const tones = {
    default: { border: "#e5e7eb", bg: "#f9fafb", color: "#111827" },
    success: { border: "#d1fae5", bg: "#ecfdf5", color: "#065f46" },
    warn: { border: "#fde68a", bg: "#fffbeb", color: "#92400e" },
    danger: { border: "#fecaca", bg: "#fef2f2", color: "#7f1d1d" },
  }[tone];
  return (
    <span
      style={{
        border: `1px solid ${tones.border}`,
        background: tones.bg,
        color: tones.color,
        padding: "4px 10px",
        fontSize: 12,
        borderRadius: 999,
        display: "inline-flex",
        alignItems: "center",
        gap: 6,
      }}
    >
      {children}
    </span>
  );
}

function Button({ children, variant = "solid", size = "md", ...props }) {
  const sizes = {
    sm: { padding: "8px 12px", fontSize: 14 },
    md: { padding: "10px 16px", fontSize: 15 },
    lg: { padding: "12px 18px", fontSize: 16 },
  }[size];

  const styles =
    variant === "solid"
      ? {
          background: "#111827",
          color: "#fff",
          border: "1px solid #111827",
        }
      : variant === "ghost"
      ? {
          background: "transparent",
          color: "#111827",
          border: "1px solid #e5e7eb",
        }
      : {
          background: "#4f46e5",
          color: "#fff",
          border: "1px solid #4338ca",
        };

  return (
    <button
      {...props}
      style={{
        ...sizes,
        ...styles,
        borderRadius: 12,
        cursor: props.disabled ? "not-allowed" : "pointer",
        opacity: props.disabled ? 0.6 : 1,
      }}
    >
      {children}
    </button>
  );
}

function Card({ children }) {
  return (
    <div
      style={{
        border: "1px solid #e5e7eb",
        borderRadius: 16,
        padding: 16,
        background: "#fff",
        boxShadow: "0 1px 0 rgba(0,0,0,0.02)",
      }}
    >
      {children}
    </div>
  );
}

function Toast({ show, tone = "success", children, onClose }) {
  if (!show) return null;
  const colors =
    tone === "success"
      ? { bg: "#ecfdf5", border: "#d1fae5", color: "#065f46" }
      : tone === "danger"
      ? { bg: "#fef2f2", border: "#fecaca", color: "#7f1d1d" }
      : { bg: "#eff6ff", border: "#bfdbfe", color: "#1e3a8a" };
  return (
    <div
      role="status"
      aria-live="polite"
      style={{
        position: "fixed",
        right: 16,
        bottom: 16,
        zIndex: 60,
        border: `1px solid ${colors.border}`,
        background: colors.bg,
        color: colors.color,
        padding: 14,
        borderRadius: 12,
        minWidth: 260,
      }}
    >
      <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
        <div style={{ fontWeight: 600 }}>{tone === "success" ? "Tudo certo" : "Aviso"}</div>
        <div style={{ marginLeft: "auto" }}>
          <button
            aria-label="fechar"
            onClick={onClose}
            style={{
              border: 0,
              background: "transparent",
              cursor: "pointer",
              fontSize: 16,
            }}
          >
            ×
          </button>
        </div>
      </div>
      <div style={{ marginTop: 6 }}>{children}</div>
    </div>
  );
}

function Modal({ open, title, onClose, children }) {
  const ref = useRef(null);
  useEffect(() => {
    function onKey(e) {
      if (e.key === "Escape") onClose?.();
    }
    if (open) document.addEventListener("keydown", onKey);
    return () => document.removeEventListener("keydown", onKey);
  }, [open, onClose]);

  if (!open) return null;
  return (
    <div
      role="dialog"
      aria-modal="true"
      aria-label={title}
      style={{
        position: "fixed",
        inset: 0,
        background: "rgba(0,0,0,0.35)",
        display: "grid",
        placeItems: "center",
        padding: 16,
        zIndex: 80,
      }}
      onClick={(e) => e.target === e.currentTarget && onClose?.()}
    >
      <div
        ref={ref}
        style={{
          width: "min(720px, 96vw)",
          background: "#fff",
          borderRadius: 16,
          border: "1px solid #e5e7eb",
          boxShadow: "0 10px 30px rgba(0,0,0,0.12)",
          padding: 20,
        }}
      >
        <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
          <h3 style={{ margin: 0, fontSize: 20 }}>{title}</h3>
          <div style={{ marginLeft: "auto" }}>
            <button
              aria-label="fechar"
              onClick={onClose}
              style={{
                border: 0,
                background: "transparent",
                cursor: "pointer",
                fontSize: 20,
                lineHeight: 1,
              }}
            >
              ×
            </button>
          </div>
        </div>
        <div style={{ marginTop: 12 }}>{children}</div>
      </div>
    </div>
  );
}

// -----------------------------
// Navegação + layout
// -----------------------------
function ScrollToTop() {
  const { pathname } = useLocation();
  useEffect(() => {
    window.scrollTo({ top: 0, behavior: "smooth" });
  }, [pathname]);
  return null;
}

function Navbar() {
  const location = useLocation();
  const active = (to) =>
    location.pathname === to
      ? { fontWeight: 700, borderBottom: "2px solid #111827", paddingBottom: 2 }
      : null;
  return (
    <header
      style={{
        position: "sticky",
        top: 0,
        zIndex: 50,
        backdropFilter: "blur(8px)",
        background: "rgba(255,255,255,0.8)",
        borderBottom: "1px solid #eee",
      }}
    >
      <Container>
        <nav
          style={{
            display: "flex",
            alignItems: "center",
            gap: 16,
            justifyContent: "space-between",
          }}
        >
          <Link to="/" style={{ textDecoration: "none", color: "#111", fontWeight: 900 }}>
            IngressAI
          </Link>
          <div style={{ display: "flex", gap: 16, alignItems: "center" }}>
            <Link to="/events" style={active("/events")}>
              Eventos
            </Link>
            <Link to="/tickets" style={active("/tickets")}>
              Ingressos
            </Link>
            <Link to="/validator" style={active("/validator")}>
              Validador
            </Link>
            <Link to="/login" style={active("/login")}>
              Login
            </Link>
            <a href="#faq">FAQ</a>
          </div>
        </nav>
      </Container>
    </header>
  );
}

function Footer() {
  return (
    <footer style={{ borderTop: "1px solid #eee", marginTop: 48 }}>
      <Container>
        <div
          style={{
            display: "flex",
            gap: 16,
            alignItems: "center",
            justifyContent: "space-between",
            flexWrap: "wrap",
          }}
        >
          <small>© {new Date().getFullYear()} IngressAI. Todos os direitos reservados.</small>
          <div style={{ display: "flex", gap: 12, alignItems: "center" }}>
            <Badge>Beta</Badge>
            <a href="https://statuspage.example" target="_blank" rel="noreferrer">
              Status
            </a>
            <Link to="/privacy">Privacidade</Link>
            <Link to="/terms">Termos</Link>
          </div>
        </div>
      </Container>
    </footer>
  );
}

// -----------------------------
// Seções da landing (Home)
// -----------------------------
function Hero() {
  const navigate = useNavigate();
  const health = useFetch(`${API_BASE}/../healthz`);

  return (
    <Section
      id="hero"
      bg="linear-gradient(180deg,#ffffff 0%, #fafafa 100%)"
      title={null}
      subtitle={null}
    >
      <div style={{ display: "grid", gap: 16 }}>
        <div>
          <Badge tone="success">Novo</Badge>
        </div>
        <h1 style={{ fontSize: 42, lineHeight: 1.15, margin: 0 }}>
          Emita, venda e valide ingressos com <span style={{ color: "#4f46e5" }}>IngressAI</span>
        </h1>
        <p style={{ color: "#555", maxWidth: 720, margin: "6px 0 0" }}>
          Crie eventos em minutos, ative vendas e valide na porta. API e webhooks prontos para
          produção, com segurança e escalabilidade.
        </p>
        <div style={{ display: "flex", gap: 12, marginTop: 8 }}>
          <Button onClick={() => navigate("/events")} aria-label="Ver eventos">
            Ver eventos
          </Button>
          <Button variant="ghost" onClick={() => navigate("/validator")} aria-label="Abrir validador">
            Abrir validador
          </Button>
        </div>
        <div style={{ marginTop: 16 }}>
          {health.loading && <small>checando backend…</small>}
          {health.error && <small style={{ color: "crimson" }}>offline: {health.error}</small>}
          {health.data?.ok && (
            <small style={{ color: "seagreen" }}>
              backend ok • env: {health.data.env}
            </small>
          )}
        </div>
      </div>
    </Section>
  );
}

function Logos() {
  return (
    <Section
      id="logos"
      subtitle="Confiado por organizadores independentes e comunidades."
    >
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fit,minmax(120px,1fr))",
          gap: 16,
          alignItems: "center",
          opacity: 0.9,
        }}
      >
        {["Aurora", "PixelMeet", "DevSummit", "ClubeXYZ", "OpenFest", "NightRun"].map((t) => (
          <Card key={t}>
            <div style={{ textAlign: "center", padding: 8, fontWeight: 700 }}>{t}</div>
          </Card>
        ))}
      </div>
    </Section>
  );
}

function Features() {
  const feats = [
    {
      t: "Criação de eventos",
      d: "Cadastre título, data, descrição e lotes em poucos cliques.",
    },
    {
      t: "Vendas online",
      d: "Gere links de checkout e acompanhe conversões em tempo real.",
    },
    {
      t: "Validação rápida",
      d: "Use app web para escanear QR e validar entradas em segundos.",
    },
    {
      t: "API & webhooks",
      d: "Integre com seu site, ERP ou automações sem fricção.",
    },
    {
      t: "Relatórios",
      d: "Exportações em CSV e métricas para tomada de decisão.",
    },
    {
      t: "Segurança",
      d: "Sessões seguras, CORS configurável e rate-limiting.",
    },
  ];
  return (
    <Section id="features" title="Tudo que você precisa" subtitle="Sem complicação, sem taxas escondidas.">
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fit,minmax(240px,1fr))",
          gap: 16,
        }}
      >
        {feats.map((f) => (
          <Card key={f.t}>
            <h3 style={{ margin: "0 0 6px" }}>{f.t}</h3>
            <p style={{ color: "#555", margin: 0 }}>{f.d}</p>
          </Card>
        ))}
      </div>
    </Section>
  );
}

function HowItWorks() {
  const steps = [
    { t: "1. Cadastre o evento", d: "Informe nome, data, local e lotes." },
    { t: "2. Ative vendas", d: "Compartilhe o link e receba pagamentos." },
    { t: "3. Valide na porta", d: "Leitor web QR com feedback instantâneo." },
  ];
  return (
    <Section id="como-funciona" title="Como funciona" subtitle="Fluxo simples do começo ao fim.">
      <div
        style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fit,minmax(260px,1fr))",
          gap: 16,
        }}
      >
        {steps.map((s) => (
          <Card key={s.t}>
            <h3 style={{ margin: "0 0 6px" }}>{s.t}</h3>
            <p style={{ color: "#555", margin: 0 }}>{s.d}</p>
          </Card>
        ))}
      </div>
    </Section>
  );
}

function CTA() {
  const navigate = useNavigate();
  return (
    <Section
      id="cta"
      bg="linear-gradient(180deg,#f8fafc 0%, #ffffff 100%)"
      title="Pronto para testar?"
      subtitle="Crie um evento agora e experimente o fluxo completo."
    >
      <div style={{ display: "flex", gap: 12 }}>
        <Button onClick={() => navigate("/events")}>Começar</Button>
        <Button variant="ghost" onClick={() => navigate("/login")}>
          Fazer login
        </Button>
      </div>
    </Section>
  );
}

function FAQ() {
  const items = [
    {
      q: "Vocês cobram taxa por ingresso?",
      a: "A taxa é configurável por evento e transparente para o comprador.",
    },
    {
      q: "Posso integrar com meu site?",
      a: "Sim, temos API REST e webhooks para eventos de compra/validação.",
    },
    {
      q: "Tem limite de validações?",
      a: "Não há limite. O validador é leve e funciona offline com fila.",
    },
    {
      q: "Como funcionam estornos?",
      a: "Respeitamos a política do organizador e as regras do meio de pagamento.",
    },
  ];

  return (
    <Section id="faq" title="Perguntas frequentes" subtitle="Algumas dúvidas comuns.">
      <div style={{ display: "grid", gap: 10 }}>
        {items.map((it, idx) => (
          <Card key={idx}>
            <details>
              <summary style={{ cursor: "pointer", fontWeight: 600 }}>{it.q}</summary>
              <p style={{ marginTop: 8, color: "#555" }}>{it.a}</p>
            </details>
          </Card>
        ))}
      </div>
    </Section>
  );
}

// -----------------------------
// Páginas (rotas)
// -----------------------------
function Home() {
  return (
    <>
      <Hero />
      <Logos />
      <Features />
      <HowItWorks />
      <CTA />
      <FAQ />
    </>
  );
}

function Login() {
  const navigate = useNavigate();
  const [email, setEmail] = useState("");
  const [busy, setBusy] = useState(false);
  const [error, setError] = useState("");
  const [ok, setOk] = useState(false);

  async function handleSubmit(e) {
    e.preventDefault();
    setBusy(true);
    setError("");
    setOk(false);
    try {
      const r = await fetch(`${API_BASE}/auth/login`, {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email }),
      });
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error || "Falha no login");
      setOk(true);
      setTimeout(() => navigate("/events"), 700);
    } catch (err) {
      setError(err.message || "Erro");
    } finally {
      setBusy(false);
    }
  }

  return (
    <Section id="login" title="Login">
      <form onSubmit={handleSubmit} style={{ maxWidth: 420, display: "grid", gap: 12 }}>
        <label>
          <span>Email</span>
          <input
            required
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            placeholder="voce@exemplo.com"
            style={{ width: "100%", padding: 10, borderRadius: 8, border: "1px solid #ddd" }}
          />
        </label>
        <Button type="submit" disabled={busy}>
          {busy ? "Entrando..." : "Entrar"}
        </Button>
        {error && <small style={{ color: "crimson" }}>{error}</small>}
      </form>
      <Toast show={ok} onClose={() => setOk(false)}>
        Login efetuado. Redirecionando…
      </Toast>
    </Section>
  );
}

function Events() {
  const [q, setQ] = useState("");
  const qd = useDebounced(q, 300);
  const { data, loading, error } = useFetch(
    `${API_BASE}/events${qd ? `?q=${encodeURIComponent(qd)}` : ""}`
  );

  return (
    <Section id="events" title="Eventos" subtitle="Encontre e gerencie seus eventos.">
      <div style={{ marginBottom: 12 }}>
        <input
          value={q}
          onChange={(e) => setQ(e.target.value)}
          placeholder="buscar eventos…"
          aria-label="buscar eventos"
          style={{
            width: "100%",
            maxWidth: 360,
            padding: 10,
            borderRadius: 10,
            border: "1px solid #ddd",
          }}
        />
      </div>
      {loading && <p>carregando…</p>}
      {error && <p style={{ color: "crimson" }}>{error}</p>}
      {!loading && !error && (
        <div
          style={{
            display: "grid",
            gridTemplateColumns: "repeat(auto-fill,minmax(260px,1fr))",
            gap: 16,
          }}
        >
          {(data?.items || []).map((ev) => (
            <Link
              key={ev.id}
              to={`/events/${ev.id}`}
              style={{
                border: "1px solid #eee",
                borderRadius: 14,
                padding: 16,
                textDecoration: "none",
                color: "inherit",
              }}
            >
              <h3 style={{ margin: 0 }}>{ev.title}</h3>
              <p style={{ margin: "6px 0", color: "#666" }}>{ev.date}</p>
              <Badge>{ev.status || "ativo"}</Badge>
            </Link>
          ))}
          {!data?.items?.length && <p>nenhum evento disponível.</p>}
        </div>
      )}
    </Section>
  );
}

function EventDetails() {
  const { id } = useParams();
  const { data, loading, error } = useFetch(`${API_BASE}/events/${id}`);
  const [open, setOpen] = useState(false);
  const navigate = useNavigate();

  return (
    <Section id="event-details" title="Detalhes do evento">
      {loading && <p>carregando…</p>}
      {error && <p style={{ color: "crimson" }}>{error}</p>}
      {data && (
        <>
          <Link to="/events" style={{ display: "inline-block", marginBottom: 12 }}>
            ← Voltar
          </Link>
          <h3 style={{ marginTop: 0 }}>{data.title}</h3>
          <p style={{ color: "#666" }}>{data.date}</p>
          <p>{data.description}</p>
          <div style={{ display: "flex", gap: 12 }}>
            <Button onClick={() => navigate("/tickets", { state: { eventId: id } })}>
              Comprar ingresso
            </Button>
            <Button variant="ghost" onClick={() => setOpen(true)}>
              Ver lotes
            </Button>
          </div>

          <Modal open={open} title="Lotes disponíveis" onClose={() => setOpen(false)}>
            <div style={{ display: "grid", gap: 10 }}>
              {(data.batches || []).map((b, i) => (
                <Card key={i}>
                  <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
                    <div style={{ fontWeight: 700 }}>{b.name}</div>
                    <Badge>{b.price}</Badge>
                    <div style={{ marginLeft: "auto", color: "#666" }}>
                      {b.remaining} restantes
                    </div>
                  </div>
                </Card>
              ))}
              {!data.batches?.length && <small>Nenhum lote cadastrado.</small>}
            </div>
          </Modal>
        </>
      )}
    </Section>
  );
}

function Tickets() {
  const location = useLocation();
  const eventId = location.state?.eventId;
  const [qty, setQty] = useState(1);
  const [busy, setBusy] = useState(false);
  const [toast, setToast] = useState({ show: false, tone: "success", msg: "" });

  async function handleBuy() {
    setBusy(true);
    try {
      const r = await fetch(`${API_BASE}/tickets/purchase`, {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ eventId, quantity: qty }),
      });
      const j = await r.json();
      if (!r.ok) throw new Error(j?.error || "Falha na compra");
      setToast({ show: true, tone: "success", msg: "Compra realizada! Verifique seu email :)" });
    } catch (e) {
      setToast({ show: true, tone: "danger", msg: e.message || "Erro" });
    } finally {
      setBusy(false);
    }
  }

  return (
    <Section id="tickets" title="Ingressos" subtitle="Selecione a quantidade e finalize a compra.">
      <div style={{ display: "flex", gap: 12, alignItems: "center" }}>
        <label>
          <span style={{ display: "block", fontSize: 12, color: "#666" }}>Quantidade</span>
          <input
            type="number"
            min={1}
            value={qty}
            onChange={(e) => setQty(parseInt(e.target.value || "1", 10))}
            style={{ width: 120, padding: 10, borderRadius: 8, border: "1px solid #ddd" }}
          />
        </label>
        <Button onClick={handleBuy} disabled={busy}>
          {busy ? "Processando…" : "Comprar"}
        </Button>
      </div>
      {!eventId && (
        <p style={{ marginTop: 12, color: "#666" }}>
          Dica: acesse um <Link to="/events">evento</Link> e clique em “Comprar ingresso”.
        </p>
      )}
      <Toast show={toast.show} tone={toast.tone} onClose={() => setToast({ ...toast, show: false })}>
        {toast.msg}
      </Toast>
    </Section>
  );
}

function Validator() {
  const [code, setCode] = useState("");
  const [result, setResult] = useState(null);
  const [busy, setBusy] = useState(false);

  async function handleValidate(e) {
    e.preventDefault();
    setBusy(true);
    setResult(null);
    try {
      const r = await fetch(`${API_BASE}/validator/scan`, {
        method: "POST",
        credentials: "include",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code }),
      });
      const j = await r.json();
      setResult({ ok: r.ok, data: j });
    } catch (e) {
      setResult({ ok: false, data: { error: e.message || "Erro" } });
    } finally {
      setBusy(false);
    }
  }

  return (
    <Section id="validator" title="Validador">
      <form onSubmit={handleValidate} style={{ display: "grid", gap: 12, maxWidth: 480 }}>
        <input
          value={code}
          onChange={(e) => setCode(e.target.value)}
          placeholder="Cole o código/QR"
          aria-label="Código QR"
          style={{ width: "100%", padding: 10, borderRadius: 8, border: "1px solid #ddd" }}
        />
        <Button type="submit" disabled={!code || busy}>
          {busy ? "Validando…" : "Validar"}
        </Button>
      </form>
      {result && (
        <pre
          style={{
            marginTop: 16,
            background: "#0b1020",
            color: "#e6e6e6",
            padding: 16,
            borderRadius: 12,
            overflow: "auto",
          }}
        >
{JSON.stringify(result, null, 2)}
        </pre>
      )}
    </Section>
  );
}

function StaticPage({ title, children }) {
  return (
    <Section id="static" title={title}>
      <div style={{ color: "#444" }}>{children}</div>
    </Section>
  );
}

function NotFound() {
  return (
    <Section id="404" title="Página não encontrada">
      <p>
        Voltar para a <Link to="/">home</Link>.
      </p>
    </Section>
  );
}

// -----------------------------
// Shell + Rotas
// -----------------------------
function AppShell() {
  return (
    <>
      <Navbar />
      <ScrollToTop />
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/login" element={<Login />} />

        <Route path="/events" element={<Events />} />
        <Route path="/events/:id" element={<EventDetails />} />

        <Route path="/tickets" element={<Tickets />} />
        <Route path="/validator" element={<Validator />} />

        <Route
          path="/privacy"
          element={
            <StaticPage title="Política de Privacidade">
              <p>Coletamos apenas o necessário para operar a plataforma.</p>
              <p>Você pode solicitar remoção de dados a qualquer momento.</p>
            </StaticPage>
          }
        />
        <Route
          path="/terms"
          element={
            <StaticPage title="Termos de Uso">
              <p>Ao usar o serviço, você concorda com os termos descritos aqui.</p>
              <p>Não nos responsabilizamos por eventos de terceiros.</p>
            </StaticPage>
          }
        />

        <Route path="*" element={<NotFound />} />
      </Routes>
      <Footer />
    </>
  );
}

// -----------------------------
// Bootstrap
// -----------------------------
function App() {
  const basename =
    (typeof import.meta !== "undefined" && import.meta.env?.VITE_BASE) ||
    (typeof process !== "undefined" && process.env?.PUBLIC_URL) ||
    "/";
  return (
    <BrowserRouter basename={basename.replace(/\/+$/, "/")}>
      <AppShell />
    </BrowserRouter>
  );
}

const container = document.getElementById("root");
const root = createRoot(container);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);

/**
 * Dicas:
 * - Ajuste VITE_API_BASE/REACT_APP_API_BASE se o backend for domínio separado.
 * - CORS no backend deve incluir a origem do front.
 * - Se quiser dividir em arquivos novamente, basta extrair seções e manter as rotas.
 */
